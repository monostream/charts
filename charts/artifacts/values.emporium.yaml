## @userSupplied ArtifactsOidcClientId
## @label Artifacts Oidc ClientId
## @type string
## @description The Oidc ClientId to use

## @userSupplied ArtifactsOidcIssuer
## @label Artifacts Oidc Issuer
## @type string
## @description The Oidc Issuer to use

## @userSupplied ArtifactsPersistenceSize
## @label Artifacts Persistence Size
## @type string
## @description Size of the local Artifacts volume

## @userSupplied ArtifactsPersistenceStorageClass
## @label Artifacts Persistence StorageClass
## @type string
## @description The StorageClass to use for the Artifacts volume

## @userSupplied PostgresqlPassword
## @label Postgresql Password
## @type string
## @description The database password to use
artifacts:
  auth:
    oidc:
      clientId: {{ .Emporium.UserSupplied.ArtifactsOidcClientId }}
      issuer: {{ .Emporium.UserSupplied.ArtifactsOidcIssuer }}
  baseUrl: https://{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}
  database:
    url: postgresql://postgres:{{ .Emporium.UserSupplied.PostgresqlPassword }}@{{ .Emporium.Name }}-postgresql:5432/artifacts
  image:
    pullPolicy: Always
    repository: monostream/artifacts
    tag: 0.0.6
  ingress:
    annotations:
      {{- if .Emporium.Annotations }}
      {{- toYaml .Emporium.Annotations | nindent 6 }}
      {{- end }}
      kubernetes.io/tls-acme: "true"
      glass.monostream.com/enabled: "true"
      glass.monostream.com/auth-disabled: "true"
      nginx.ingress.kubernetes.io/proxy-body-size: "0"
      nginx.ingress.kubernetes.io/proxy-buffering: "off"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "900"
      nginx.ingress.kubernetes.io/proxy-request-buffering: "off"
    enabled: true
    hosts:
    - host: {{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}
      paths:
      - path: /
        pathType: Prefix
    - host: api.{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}
      paths:
      - path: /
        pathType: Prefix
    - host: '*.docker.{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}'
      paths:
      - path: /
        pathType: Prefix
    - host: '*.helm.{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}'
      paths:
      - path: /
        pathType: Prefix
    - host: '*.maven.{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}'
      paths:
      - path: /
        pathType: Prefix
    - host: '*.nuget.{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}'
      paths:
      - path: /
        pathType: Prefix
    - host: '*.npm.{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}'
      paths:
      - path: /
        pathType: Prefix
    ingressClassName: nginx
    tls:
    - hosts:
      - {{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}
      - api.{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}
      - '*.docker.{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}'
      - '*.helm.{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}'
      - '*.maven.{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}'
      - '*.nuget.{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}'
      - '*.npm.{{ .Emporium.Subdomain }}.{{ .Emporium.DNSZone }}'
      secretName: artifacts-tls
  persistence:
    enabled: true
    size: {{ .Emporium.UserSupplied.ArtifactsPersistenceSize }}Gi
    storageClass: {{ .Emporium.UserSupplied.ArtifactsPersistenceStorageClass }}
  serviceAccount:
    create: true
    name: artifacts
  storage:
    filesystem:
      path: /data

postgresql:
  auth:
    database: artifacts
    postgresPassword: {{ .Emporium.UserSupplied.PostgresqlPassword }}